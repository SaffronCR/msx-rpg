//------------------------------------------------------------------
// Star Rangers - A Dungeon Crawler for MSX2 using Fusion-C
//------------------------------------------------------------------

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "fusion-c/header/msx_fusion.h"

#include "encounter.h"

//------------------------------------------------------------------
// Defines.
//------------------------------------------------------------------

#define DEFAULT_ENCOUNTER_THRESHOLD 10

//------------------------------------------------------------------
// Variables.
//------------------------------------------------------------------

const uchar encounter_table[] =
{
    31,  166, 222, 186, 204,  18, 125, 116,  27, 243, 180, 136, 248,  82, 244,   7,
    144, 171, 179, 189, 170,  85,  40, 188, 138, 109,  14, 196, 131, 169,  59, 118,
     32, 124,   9, 146, 253,  74, 168, 240,  97, 227, 242, 105, 108, 187,  56, 195,
    174, 183,  67, 132, 120,  35, 123, 155,  45, 219,  62, 145, 207,   2,  42, 182,
    134, 238, 156, 142, 184, 111,  26,  87,   5, 233, 115,  49, 210, 217,  29, 251,
    148, 157, 177,  10,  58,  17,  90,  71, 149,  44,  68, 224, 106, 140,  91, 122,
    167,  93,  54, 112, 229, 199,  73, 220, 104, 151, 216, 102, 163,  15, 176, 159,
      3, 214, 119,  22,  19,  48,  37,  60,  16,  23, 173, 152, 107,  47, 215, 161,
    255, 164, 235,  81, 254,  39, 141, 147, 213,  61, 246,   8, 117, 225, 165,  70,
     99, 245,  77, 218,  50, 175,  64,  55, 211, 192, 137, 103,   6,  33, 110, 129,
    181, 160,  79,  12,  46, 231,  28,  88, 133, 232,  89, 206,  53, 203,  30, 198,
     43, 154, 230, 221, 241, 236, 150, 202, 172,   0,  80, 201,  76, 252,  20, 126,
     86, 128, 208, 121, 191,  41, 135,  72,  36,  25, 197,  34, 113, 127, 114,  13,
    205, 143, 190,  63, 158,  52, 237,  83,  84,   4,  98, 162, 194,  65,  94, 130,
     75,  38,  92,  66, 101, 153,  78,  96, 139, 247,  11,  51, 223, 209, 100, 200,
    193,   1, 239, 249, 250, 228,  95,  24, 185, 178,  57, 212,  21, 226, 234,  69
};

uchar current_step;
uchar current_threshold;

//------------------------------------------------------------------
// Functions.
//------------------------------------------------------------------

void sr_init_encounter(void)
{
	current_step = 0;
	current_threshold = DEFAULT_ENCOUNTER_THRESHOLD;
}

void sr_encounter_step(void)
{
	current_step++;
}

bool sr_check_encounter(void)
{
	return (encounter_table[current_step] < current_threshold);
}
